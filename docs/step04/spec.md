# 📄 Step 4 規格書（主畫面骨架＋多語系）

## 1. 階段目標
- 建立主畫面骨架：角色點擊區、主資源顯示、上方任務條佔位、右側功能列入口（裝備/寵物/稱號/商城/任務/設定/音樂）。
- 右側/上方功能入口依 `assets/images/layout.png` 位置配置並套用對應 icon。
- 下方 5 個主導航按鈕（稱號/寵物/主頁/裝備/商城）點擊有**左右放大**壓感動畫並可切頁（切頁先顯示功能名稱）。
- 角色點擊：0.1s 壓感動畫；同時在角色周圍隨機位置生成 `PlusMemePoint.png` 特效飄出。
- 介面支援多國語系（EN/ZH/JP/KO），切換即時生效。
- 非主頁背景需淡化 50%。

---

## 2. 功能需求
1. **資產與背景**
   - 背景圖：主頁使用 `assets/images/background/Base.png`，填滿安全區（維持等比裁切，置中）。
   - 切換至非主頁（稱號/寵物/裝備/商城/任務/設定/音樂）時，背景加上 50% 淡化（Opacity=0.5；或覆蓋半透明黑層 `rgba(0,0,0,0.5)`）。
   - 中央主角：`assets/images/character/HippoBase.png`，置中顯示，支援縮放以適配不同螢幕比例。

2. **主畫面區塊與布局**
   - 參考圖：`assets/images/layout.png`；UI 以相對百分比與 SafeArea 安置。
   - **上方：任務條佔位**（暫顯示 placeholder bar，高度約螢幕高 8%）。
   - **右側：功能列入口（自上而下）**
     - NoADS：`assets/images/icon/NOADS.png`
     - 設定：`assets/images/icon/Setting.png`
     - 任務：`assets/images/icon/Quest.png`
     - KTV：`assets/images/icon/MusicGame.png`
   - **下方：主導航按鈕（由左至右）**
     - 稱號：`assets/images/icon/TitleBadge.png`
     - 寵物：`assets/images/icon/Pet.png`
     - 主頁：`assets/images/icon/Home.png`
     - 裝備：`assets/images/icon/Equipment.png`
     - 商城：`assets/images/icon/Shop.png`
   - **主資源顯示**：畫面上方中央顯示迷因點數（暫以 0，數字右方可保留 +/s 佔位）。

3. **互動與動畫**
   - **角色點擊壓感**
     - 動畫：縮放 `scale 1.0 → 0.95 → 1.0`，總時長 0.1s，easeOut。
     - 點擊命中區域＝角色圖片外框（透明像素不算）。
   - **加分特效（PlusMemePoint）**
     - 素材：`assets/images/icon/PlusMemePoint.png`。
     - 生成：每次角色點擊成功 **至少 1 個粒子**（後續可調整 1~3 隨機），出生點為角色邊界內的隨機位置（半徑＝角色寬度 * 0.4）。
     - 動畫：上飄 `y -40~ -80` 隨機、透明度 `1 → 0`、縮放 `0.9 → 1.2`，時長 0.6~0.8s 隨機，easeOut，結束自動銷毀。
     - 同一時間最多顯示 10 個粒子（超出則丟棄最舊或不再生成）。
   - **下方按鈕壓感（左右放大）**
     - 動畫：`scaleX 1.0 → 1.08 → 1.0`、`scaleY 1.0 → 0.98 → 1.0`，總時長 0.12s，easeOut。
     - 按下即觸發頁面切換。
   - **右側功能列按鈕**
     - 同下方按鈕壓感規則（可共用動畫器）。
   - **切頁過場**
     - 以淡入淡出 150ms（主頁 → 其他頁），回主頁同規則。

4. **頁面切換與標題**
   - 點擊各功能入口或下方主導航，切換到對應頁面（先建立空白頁）。
   - 各頁**中央上方**顯示該功能名稱（i18n）：例「裝備 / Equipment」。

5. **多國語系（EN/ZH/JP/KO）**
   - 所有文字鍵值化，放於 `assets/lang/{en,zh,jp,ko}.json`。
   - 需涵蓋：主資源標籤、各功能頁名稱（Title/Equipment/Home/Pets/Shop/Quest/Settings/MusicGame/NoAds）、通用文字。
   - 設定頁可即時切換語言；切換後本階段所有文字立即更新。

6. **層級與點擊穿透**
   - Z-Index：背景 < 角色 < 加分粒子 < 右側/下方按鈕 < 任務條。
   - 粒子不阻擋按鈕點擊（忽略指標事件）。

7. **資產載入與錯誤處理**
   - 所有圖片資產需預載，載入失敗時以灰色方塊＋警示符號代替，不影響操作。
   - 缺圖記錄到 console（之後接 GA 可擴充）。

---

## 3. 驗收標準
- ✅ **主畫面結構**：背景、角色、上方任務條佔位、右側功能列、下方 5 按鈕皆依 layout 位置顯示。
- ✅ **角色點擊動畫**：點擊角色觸發 0.1s 壓感（1.0→0.95→1.0），無掉幀。
- ✅ **加分粒子**：每次角色點擊在角色周圍隨機生成 `PlusMemePoint`，上飄並淡出，最長 0.8s，自動銷毀；同屏不超過 10 個。
- ✅ **按鈕壓感**：下方/右側按鈕點擊時有左右放大動畫（X 1.08、Y 0.98），時長 0.12s。
- ✅ **切頁與標題**：點擊任一按鈕能切到對應頁，頁面中央上方顯示 i18n 功能名稱（例：裝備/Equipment）。
- ✅ **背景淡化**：非主頁時背景有效果 50%（或覆蓋半透明黑層等效）。
- ✅ **多語系**：切換至 JP/KO 時，頁面標題與主資源標籤正確換語；回 EN/ZH 亦同，無需重啟即生效。
- ✅ **點擊穿透**：粒子特效不阻擋任何按鈕點擊。

---

## 4. 實例化需求測試案例

### 測試案例 1：主畫面構成
- **Given** App 啟動進入主頁  
- **When** 完成資產載入  
- **Then** 應看到背景 Base.png、中央 HippoBase.png、上方任務條佔位、右側 4 個圖示與下方 5 個主導航按鈕

---

### 測試案例 2：角色點擊壓感＋粒子
- **Given** 主頁顯示  
- **When** 點擊主角一次  
- **Then** 主角 0.1s 壓感播放完畢，且角色周圍隨機位置出現 1 個 PlusMemePoint 粒子往上飄並淡出

---

### 測試案例 3：按鈕壓感與切頁
- **Given** 主頁顯示  
- **When** 依序點擊「裝備」「寵物」「商城」  
- **Then** 每次點擊按鈕會有左右放大 0.12s 動畫，並切換到對應頁面；頁面中央上方顯示對應名稱（i18n）

---

### 測試案例 4：非主頁背景淡化
- **Given** 於主頁  
- **When** 進入「裝備」頁  
- **Then** 背景相對主頁淡化 50%（或等效半透明覆蓋）

---

### 測試案例 5：多語系切換
- **Given** 目前語言 ZH  
- **When** 在設定頁切換為 EN（即時切換）  
- **Then** 主頁標籤與功能頁標題立即以英文顯示；切回 JP/KO 亦可正確切換

---

### 測試案例 6：粒子上限
- **Given** 連點角色 20 次  
- **When** 粒子生成並播放  
- **Then** 同屏同時顯示粒子不超過 10 個（最舊先完成或丟棄生成），無明顯掉幀

---

## 5. 限制與備註
- Flutter 3.22+、Flame ^1.17+；圖片需於 `pubspec.yaml` 正確註冊。
- 介面採百分比/自適應布局，需支援常見比例（16:9、19.5:9、21:9）與平板。
- 多語系字型：若出現字寬溢出，使用自動寬度/縮放或適配字型（Noto Sans JP/KR）。
- 動畫持續時間、粒子數量以常數配置，後續可資料化到 `assets/config/ui.json`。
- 本階段僅切頁與顯示，無需串接實際功能邏輯（裝備/寵物等在後續階段實作）。
