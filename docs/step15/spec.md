# 📄 Step 15 規格書（寵物系統基礎：單隻裝備）

## 1. 階段目標
- 實作寵物系統雛形，支援 **寵物列表 / 單隻裝備 / 升級機制**。
- 先行建立一組測試寵物「彈跳豬 MooDeng」，五種稀有度（RR/R/S/SR/SSR）。
- 可透過 Debug 按鈕模擬獲得相同寵物點數以驗證升級邏輯。
- 放置收益 `idlePerSec` 會根據裝備的寵物與其等級即時變動。

---

## 2. 功能需求

### 2.1 寵物列表
- 預設生成五隻「彈跳豬 MooDeng」，稀有度分別為：
  - **SSR**（紅色框）
  - **SR**（紫色框）
  - **S**（藍色框）
  - **R**（綠色框）
  - **RR**（灰色框）
- 排序規則：
  1. 稀有度排序：SSR > SR > S > R > RR  
  2. 相同稀有度內，依照 `petKey` 名稱字典序排序。
- 每隻寵物顯示：
  - 圖像：`assets/images/pet/MooDeng.png`
  - 名稱：彈跳豬（多國語系）
  - 稀有度外框顏色
  - 等級（Lv）
  - 當前 `idlePerSec` 貢獻

### 2.2 單隻裝備
- 玩家同時僅能裝備 **一隻寵物**。
- UI：列表內可點擊任一寵物 → 標記為「已裝備」。
- 切換裝備時，遊戲總放置收益 `idlePerSec` 需即時重新計算。

### 2.3 初始數值
各稀有度初始 `idlePerSec`：
- SSR：0.5/s
- SR：0.4/s
- S：0.3/s
- R：0.2/s
- RR：0.1/s

### 2.4 升級規則
- 升級需消耗「相同寵物點數」；點數來源：抽到相同稀有度同一隻寵物。
- 升級需求遵循**費氏數列**：
  - Lv1 → Lv2：需 1 點
  - Lv2 → Lv3：需 2 點
  - Lv3 → Lv4：需 3 點
  - Lv4 → Lv5：需 5 點
  - Lv5 → Lv6：需 8 點
  - Lv6 → Lv7：需 13 點
  - Lv7 → Lv8：需 21 點
  - …以此類推（無上限）。
- 升級後 `idlePerSec` 計算：
```
idlePerSec = baseIdle \* (1 + Σ levelUpUpgrade)
```
- `levelUpUpgrade` 初始 = 0.5
- 每過 10 等，`levelUpUpgrade` 減半：
  - Lv1~9 → +0.5
  - Lv10~19 → +0.25
  - Lv20~29 → +0.125
  - Lv30~39 → +0.0625
  - 以此類推

### 2.5 Debug 輔助
- Debug 面板提供：
- 按鈕：「+1 MooDeng(RR/R/S/SR/SSR) 點數」→ 對應寵物累積升級點數。
- 顯示每隻寵物：
  - 當前等級
  - 已累積點數
  - 下一級需求點數（費氏數列）
  - 當前 idlePerSec 貢獻值

---

## 3. 驗收標準
- ✅ **即時切換**：點擊不同稀有度的 MooDeng 寵物，遊戲 `idlePerSec` 即時切換至該寵物數值。
- ✅ **初始值正確**：SSR=0.5/s，SR=0.4/s，S=0.3/s，R=0.2/s，RR=0.1/s。
- ✅ **升級驗證**：
- 初始 Lv1 → 升至 Lv2 需 1 點；Lv2→Lv3 需 2 點；Lv3→Lv4 需 3 點；正確遵循費氏數列。
- ✅ **等級加成遞減**：
- Lv5 時 idlePerSec = `baseIdle * (1 + 5*0.5) = base * 3.5`
- Lv10 → `levelUpUpgrade=0.25`，idlePerSec 正確變為 `base * (1 + (9*0.5 + 1*0.25))`
- ✅ **僅單隻裝備**：同時只能有 1 隻寵物貢獻放置收益，切換裝備後舊寵物的加成立即移除。

---

## 4. 實例化需求測試案例

### 案例 1：切換即時改變
- **Given** 當前裝備 SSR MooDeng（0.5/s）  
- **When** 玩家切換為 R MooDeng（0.2/s）  
- **Then** `idlePerSec` 從 0.5 → 0.2  

---

### 案例 2：升級費氏數列
- **Given** R MooDeng，Lv1，累積點數=0  
- **When** 獲得 1 點數 → 升級至 Lv2（消耗 1）  
- **Then** Lv2 成功，下一級需求=2 點  

---

### 案例 3：升級加成
- **Given** SR MooDeng（base=0.4/s），Lv5  
- **When** 累積達到升級需求 → 升至 Lv6  
- **Then** idlePerSec = `0.4 * (1 + Σ升級加成)` 正確變動  

---

### 案例 4：跨等級驗證 levelUpUpgrade 減半
- **Given** SSR MooDeng，升到 Lv10  
- **When** 查看升級加成  
- **Then** 前 9 次升級使用 +0.5，第 10 次使用 +0.25；idlePerSec 計算正確  

---

### 案例 5：僅單隻裝備
- **Given** 玩家同時擁有 SSR 和 SR MooDeng  
- **When** 嘗試同時裝備兩隻  
- **Then** 僅最後一次選定的寵物有效，`idlePerSec` 僅包含一隻貢獻  

---

## 5. 限制與備註
- 本階段僅支援 **單隻裝備**，後續可擴充「多隻上陣」或「羈絆效果」。
- 目前所有寵物角色均使用相同圖像與名稱，僅稀有度不同。
- 升級點數僅能透過 Debug 注入，真實抽獎系統留待後續（Step XX）。
- 公式與等級邏輯需保證浮點計算誤差 ≤1%。

